# مواصفة المتطلبات الهندسية لتطبيق Adham AgriTech

## 1. المقدمة
يهدف هذا المستند إلى تحويل الرؤية العامة لمنصة Adham AgriTech إلى مواصفة هندسية قابلة للتنفيذ، تربط بين فرق المنتج، والهندسة، والذكاء الاصطناعي، والعمليات، والأمن. تغطي المواصفة نطاق العمل، المتطلبات الوظيفية وغير الوظيفية، بنية الحل المقترحة، وحوكمة البيانات والنشر لضمان تنفيذ متدرج وموثوق.

## 2. الأهداف الإستراتيجية للمشروع
1. **كشف مبكر ودقيق:** تمكين فرق الزراعة من رصد الأمراض والآفات ميدانيًا وبالاستشعار عن بُعد، مع تقليل زمن الاستجابة للتشخيص.
2. **قناة عمل مؤسسية آمنة:** دعم Workgroups خاصة بالمؤسسات لضبط الأدوار، بروتوكولات العلاج، ومشاركة التنبيهات داخليًا فقط.
3. **تعلم مستمر للنماذج:** تصميم دورة حياة بيانات كاملة تغذي نماذج التشخيص بسرعة بأمثلة جديدة (few-shot) وتدريب مستمر.
4. **تنسيق العمليات الميدانية:** ربط التشخيص، التوصيات، المهام، والنتائج الموثقة مع مؤشرات الأداء الرئيسية (KPIs) لتحسين العمليات.
5. **قابلية التوسع والامتثال:** ضمان القدرة على التوسع الجغرافي مع تلبية متطلبات الأمان، الخصوصية، والامتثال المحلي.

## 3. نطاق الحل
- **المنصات:** تطبيقات محمولة (iOS/Android) ولوحة ويب تفاعلية للمشرفين والإدارة.
- **الخدمات الخلفية:** واجهة API موحدة، خدمات معالجة الصور، محرك استدلال AI، خدمة تدريب وإدارة نماذج، تحليل جغرافي، طقس وفينولوجيا، إشعارات ومهام.
- **المصادر الخارجية:** مزودو بيانات الطقس، مزودو صور أقمار صناعية متعددة الأطياف، مزودو دفع الإشعارات والبريد الإلكتروني.
- **الاستثناءات:** التكامل مع أجهزة استشعار خاصة أو منصات ERP خارجية غير ضمن المرحلة الأولى إلا بمشروعات لاحقة.

## 4. المتطلبات الوظيفية
### 4.1 إدارة المستخدمين وWorkgroups
- تسجيل مستخدمين بأدوار مرنة: SuperAdmin، Admin، Editor، Inspector، Viewer.
- مصادقة بالبريد أو الهاتف مع خيار التحقق الثنائي (2FA).
- إنشاء Workgroups، دعوات الأعضاء، سياسات المشاركة، وإدارة صلاحيات دقيقة.

### 4.2 تطبيق الميدان (Mobile Client)
- التقاط صور مع geotag ووقت الالتقاط، وإضافة ملاحظات نصية أو صوتية.
- تخزين محلي مع مزامنة تلقائية عند توفر الاتصال.
- استقبال مهام وتنبيهات، وعرض موجز يومي وحالة الطقس المحلية.

### 4.3 التشخيص والاستدلال
- معالجة مسبقة للصور (ضغط، تصحيح لوني، إزالة بيانات حساسة عند الحاجة).
- استدعاء نموذج AI يعيد التشخيص، نسبة الثقة (0–100%)، وتوصيات علاجية قابلة للتخصيص.
- تحويل الحالات ذات الثقة المنخفضة إلى قائمة مراجعة المشرفين، مع واجهة لتأكيد التشخيص أو تحديثه.

### 4.4 مكتبة البروتوكولات والمعارف
- تخزين بروتوكولات علاجية حسب المحصول، المنطقة، والمرحلة الفينولوجية.
- ربط آلي بين التشخيص والبروتوكولات المعتمدة داخل Workgroup.
- تضمين تحذيرات السلامة، الجرعات، ومتطلبات معدات الوقاية.

### 4.5 المراقبة عن بعد والاستشعار
- استيراد بيانات أقمار صناعية متعددة الأطياف (NDVI، مؤشرات كلوروفيل، إلخ).
- عرض خرائط زمنية لتطور صحة الحقول مع تمييز مناطق الخطر.
- مقارنة قبل/بعد التدخلات وربط النتائج بالمهام المنفذة.

### 4.6 الطقس والفينولوجيا
- دمج مزود طقس (دقة ≈3 كم) وتحديث التوقعات يوميًا.
- حساب Growing Degree Days، ونماذج فينولوجيا قابلة للتخصيص لكل محصول.
- إطلاق تنبيهات عند تحقق شروط جوية أو مراحل حساسة.

### 4.7 المهام والإشعارات والتقارير
- إنشاء مهام مرتبطة بالحقل/الموقع مع تعيين للمستخدم وتتبع حالة الإنجاز.
- إرسال تنبيهات داخل التطبيق، بريد، و/أو SMS حسب إعدادات Workgroup.
- تقارير دورية بمؤشرات الصحة، دقة التشخيص، نسب الاعتماد على التوصيات، وتحليل الفاعلية.

### 4.8 قياس الأثر والتحسين
- تسجيل التدخلات (نوع العلاج، التاريخ، الكمية) وربطها بالبيانات الميدانية والأقمار الصناعية.
- حساب مؤشرات قبل/بعد وتوصية بتحسين البروتوكولات بناءً على النتائج.
- تغذية مكتبة النماذج بالصور المشروحة لإعادة التدريب.

## 5. المتطلبات غير الوظيفية
### 5.1 الأداء
- زمن الاستدلال المستهدف ≤ 10 ثوانٍ في 90% من الحالات (صور ≤ 12MB).
- تحميل صفحات لوحة التحكم الأساسية ≤ 3 ثوانٍ على اتصال 10 Mbps.
- دعم وضع صف/رسائل (queue) لضمان المرونة في أوقات الذروة.

### 5.2 الأمان والخصوصية
- مصادقة OAuth2/JWT، تشفير TLS 1.2+ أثناء النقل، وتشفير at-rest للبيانات الحساسة.
- سياسات وصول granular على مستوى Workgroup وسجلات تدقيق لكل التعديلات الحساسة.
- خيارات استضافة محلية أو سحابة هجينة للامتثال التنظيمي.

### 5.3 الاعتمادية والصيانة
- آليات Retry، كشف التعارضات، وحلها للمزامنة في وضع عدم الاتصال.
- نسخ احتياطي دوري (يومي/أسبوعي) مع RTO ≤ 4 ساعات وRPO ≤ 1 ساعة للبيانات الحرجة.
- عمليات CI/CD مع اختبارات وحدات، تكامل، ونظام مراقبة للتنبيهات.

### 5.4 قابلية التوسع والتدويل
- تصميم ميكروسيرفيس مع autoscaling أفقي وعمودي.
- دعم لغات متعددة (العربية، الإنجليزية، لغات محلية) في التطبيقات.
- إمكانية إضافة Workspaces جديدة دون تأثير على الأداء الحالي.

## 6. البنية المعمارية المقترحة
### 6.1 نظرة عامة
يتكون الحل من ثلاث طبقات أساسية: طبقة العميل (تطبيق جوال + لوحة ويب)، بوابة API مركزية، وطبقة خدمات خلفية موزعة. تتصل الخدمات بمخازن بيانات متخصصة، مع طبقة ذكاء اصطناعي منفصلة ومراقبة متقدمة.

```
[Mobile Apps / Web Dashboard]
        │
        ▼
[API Gateway / BFF]
        │
 ┌──────┴────────┬───────────┬───────────┐
 │              │           │           │
 ▼              ▼           ▼           ▼
Image Service  AI Inference Tasking    Weather/Phenology
 │              │           │           │
 ▼              ▼           ▼           ▼
Object Store  Model Svc   Ops DB      Weather DB
        │            │           │
        ▼            ▼           ▼
    Data Lake   Model Registry  Analytics Warehouse
```

### 6.2 طبقة العميل
- **تطبيق جوال:** مبني بإطار متعدد المنصات (React Native أو Flutter) لدعم iOS/Android، مع وحدة مزامنة offline-first، وإدارة وسائط فعّالة (ضغط، تحميل متدرج).
- **لوحة ويب:** تطبيق React/Next.js مع دعم i18n، يعرض خرائط تفاعلية (Mapbox/Leaflet)، واجهات مراجعة الصور، ولوحات مؤشرات قابلة للتخصيص.

### 6.3 بوابة API وBFF
- طبقة Gateway (مثل Kong أو AWS API Gateway) لتجميع المصادقة، التحكم في المعدل (rate limiting)، وتوجيه الطلبات.
- طبقة Backend-for-Frontend (BFF) مخصصة للجوال والويب لتحسين تجميع البيانات وتخفيض عدد الطلبات.

### 6.4 الخدمات الخلفية الأساسية
| الخدمة | الوظائف الأساسية | التقنيات المقترحة |
|--------|-------------------|--------------------|
| **Image Intake Service** | استقبال الصور، التحقق، المعالجة المسبقة، تخزين في Object Storage | Node.js/Express أو FastAPI، تكامل مع S3/GCS |
| **AI Inference Service** | تشغيل النماذج، حساب الثقة، إرسال النتائج والاقتراحات | Python (TorchServe/BentoML)، دعم GPU |
| **Model Training & Registry** | تجميع الصور المشروحة، التدريب الدوري، إدارة الإصدارات | Kubeflow/Airflow + MLflow |
| **Geo Analytics Service** | جلب ومعالجة صور الأقمار الصناعية، حساب NDVI، خرائط زمنية | Python/Scala مع Rasterio/GeoPandas، Spark عند الحاجة |
| **Weather & Phenology Service** | تكامل API الطقس، حساب GDD، توليد تنبيهات المرحلة الحساسة | Python (FastAPI)، قواعد بيانات زمنية |
| **Tasking & Notification Service** | إدارة المهام، المزامنة مع تطبيق الجوال، الإشعارات | Node.js NestJS، تكامل مع Firebase/APNs/Email |
| **Supervisor Review Service** | قوائم المراجعة، Workflow للموافقة، تحديث مكتبة النماذج | GraphQL/REST، تكامل مع Model Registry |

### 6.5 طبقة البيانات
- **Object Storage:** لتخزين الصور الخام والمُعالَجة (Amazon S3، Google Cloud Storage، أو MinIO ذاتي).
- **Operational DB:** قاعدة بيانات علائقية (PostgreSQL) للكيانات التشغيلية (المستخدمين، الحقول، المهام).
- **Time-Series/Geo DB:** (PostGIS، TimescaleDB) لحفظ القياسات الزمنية والإحداثيات.
- **Analytics Warehouse:** (BigQuery/Snowflake/Redshift) لتقارير الأداء ومؤشرات الفاعلية.
- **Data Lake:** لتجميع بيانات متعددة (Raw، Curated، Feature Store) تدعم التدريب التحليلي.

### 6.6 التكامل مع الأطراف الخارجية
- **مزودو الطقس:** تكامل عبر APIs (مثل Meteomatics، Tomorrow.io، WeatherBit) مع خطط احتياطية.
- **صور الأقمار الصناعية:** شراكات مع مقدمي بيانات (Sentinel، Planet، EOSDA) مع جدولة تنزيل مؤتمتة.
- **قنوات الإشعار:** Firebase Cloud Messaging، Apple Push Notification، Twilio للبريد/SMS.

## 7. إدارة دورة حياة البيانات والنماذج
1. **التجميع:** تخزين الصور والملاحظات مباشرة في طبقة Raw مع بيانات وصفية كاملة (Workgroup، الموقع، الوقت، المحصول).
2. **المعالجة:** تطبيق خط أنابيب ETL لإزالة الضوضاء، توحيد التنسيق، وتوليد ميزات مثل أنماط الأوراق.
3. **الترميز البشري:** واجهة المشرف تتيح تصنيف الصور، وتخزين التسميات في قاعدة بيانات مشروحة.
4. **التدريب:** جدولة دورات تدريبية (أسبوعية/شهرية) للنماذج مع تقارير أداء.
5. **النشر:** نشر النموذج عبر Model Registry مع إستراتيجية Canary/Rollback.
6. **المراقبة:** قياس جودة النماذج (Precision/Recall) وتوليد تنبيهات عند انحراف الأداء.

## 8. الأمان والامتثال
- **الهوية والوصول:** إدارة هوية مركزية (Keycloak/Auth0) مع RBAC وABAC حسب Workgroup.
- **التشفير:** تشفير تخزين الصور والبيانات الحساسة باستخدام KMS، تدوير المفاتيح دوريًا.
- **التدقيق:** سجلات تدقيق لكل عمليات الدخول، التعديلات، نشر النماذج، والوصول للبيانات الحساسة.
- **الامتثال:** مراجعة المتطلبات المحلية (مثل GDPR، القوانين البيئية، لوائح مبيدات الآفات) قبل النشر بكل منطقة. توفير أدوات حذف البيانات وتقييد المشاركة عبر Workgroup.

## 9. خطة الاختبار وضمان الجودة
| نوع الاختبار | الهدف | الأدوات |
|--------------|-------|---------|
| اختبارات الوحدة | ضمان صحة الوظائف المنفصلة للخدمات | Jest/PyTest |
| اختبارات التكامل | التحقق من تفاعل الخدمات والـ API | Postman/Newman، Pact |
| اختبارات النظام الشاملة | التحقق من مسار المستخدم end-to-end (صورة → تشخيص → مهمة) | Cypress، Detox (للمحمول) |
| اختبارات الأحمال | تقييم الأداء تحت الضغط | Locust، k6 |
| اختبار النماذج | قياس Precision/Recall وF1 لكل فئة مرضية | MLflow، Evidently AI |
| اختبار الأمان | فحص الثغرات واختبار الاختراق | OWASP ZAP، Burp Suite |

## 10. مؤشرات الأداء الرئيسية (KPIs)
- زمن الاستجابة للتشخيص الآلي (الهدف ≤ 10 ثوانٍ).
- دقة التشخيص (Precision/Recall لكل فئة رئيسية) عند مستويات ثقة مختلفة.
- نسبة الحالات التي تتطلب مراجعة بشرية.
- معدل تنفيذ المهام الموصى بها في الوقت المحدد.
- تحسن متوسط NDVI أو مؤشرات الصحة النباتية بعد التدخلات مقارنةً بخط الأساس.

## 11. خارطة طريق التنفيذ (6–9 أشهر)
| الفترة | الأنشطة الرئيسية |
|--------|------------------|
| شهر 0–1 | تصميم تجربة المستخدم، تعريف حالات الاستخدام، إعداد البنية التحتية التطويرية |
| شهر 2–3 | بناء تطبيق ميداني أولي، واجهة API أساسية، إدارة مستخدمين وWorkgroups |
| شهر 4 | إطلاق خدمة استدلال أولية ولوحة مراجعة المشرفين، دعم وضع عدم الاتصال |
| شهر 5 | دمج بيانات الطقس الأولية، حساب GDD، إضافة نظام المهام والإشعارات |
| شهر 6 | دمج بيانات الأقمار الصناعية (NDVI) وإصدار تقارير أساسية، تشغيل مشروع Pilot |
| شهر 7–9 | تحسين النماذج، مراقبة الجودة، اختبارات الأمان، التوسع التدريجي للبيتا |

## 12. المخاطر وخطط التخفيف
| الخطر | الوصف | خطة التخفيف |
|-------|--------|--------------|
| اعتماد مفرط على التشخيص الآلي | خطر التوصية بمعالجات خاطئة | حدود ثقة، مراجعة بشرية إلزامية، سجلات قرار |
| نقص تمثيل البيانات | صور تدريب محدودة لمحاصيل/مناطق معينة | حملات جمع بيانات، حوافز للمستخدمين، شراكات بحثية |
| تأخر بيانات الطقس/الأقمار | فجوات في المعطيات تؤثر على القرارات | مزودون متعددون، خوارزميات استكمال، تخزين بيانات تاريخية |
| تحديات الامتثال | قوانين البيانات تختلف بين الدول | خيارات استضافة محلية، سياسة بيانات قابلة للتكوين، استشارات قانونية |
| ضغط الأداء أثناء الذروة | كثافة رفع صور في مواسم محددة | Autoscaling، Queue، مراقبة تنبيهات، تحسينات caching |

## 13. مخرجات ومستندات مكملة
- **مواصفات API:** ملفات OpenAPI/GraphQL Schema محدثة.
- **نماذج البيانات:** ERD وجداول Postgres وSchemas JSON.
- **دليل النشر:** تعليمات CI/CD، إعداد البنية السحابية، قوالب Terraform/Helm.
- **دليل المستخدم الميداني:** إجراءات التقاط الصور، تسجيل الملاحظات، تنفيذ المهام.
- **خطة الاختبار والتقارير:** نتائج الاختبارات، تقارير أمان، تقارير أداء النموذج.

## 14. الخطوات التالية المقترحة
1. توحيد متطلبات البيانات مع فريق الزراعة لتحديد المحاصيل/الآفات ذات الأولوية لكل منطقة.
2. إطلاق دراسة جدوى لتكلفة مزودي البيانات (طقس، أقمار صناعية) وتحديد العقود.
3. إعداد بيئة تطوير متكاملة (Dev/Staging) مع مراقبة ونظام ملاحظات (Observability) منذ اليوم الأول.
4. تطوير بروتوتايب سريع لمسار "التقاط صورة → تشخيص → إحالة" لاختبار تجربة المستخدم وجمع التغذية الراجعة.

---
**ملحوظة:** يوصى بإرفاق هذا المستند مع مخطط معماري مرئي (Architecture Diagram) وتوثيق نسخة PDF مترجمة للفرق الدولية.
