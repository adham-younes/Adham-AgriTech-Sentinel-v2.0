# تدقيق الإنتاج والمستودع بدون تعطيل

## الأهداف
- فحص دقيق للمستودع الحالي وتحليل المعمارية والمشكلات.
- تدقيق غير مُعطِّل لتطبيق الإنتاج على النطاق `adham-agritech.com` (المستضاف على Vercel وفق الافتراض)، مع رسم خريطة الفرق بينه وبين المستودع.
- تقديم تقرير فني عملي وتحسينات أولية، مع الحفاظ الكامل على تشغيل الإنتاج وعدم تنفيذ أي تغييرات أو نشرات.

## قيود أساسية (سلامة الإنتاج)
- عدم إجراء أي نشر أو تعديل DNS أو تغييرات بيئية على مشروع الإنتاج.
- الاقتصار على فحوصات قراءة فقط (HTTP headers/health checks/مراجعة سجلات بقراءة) أو إنشاء بيئة Staging منفصلة لاحقًا بعد موافقة صريحة.

## نطاق العمل
1. مراجعة المستودع (قراءة فقط):
   - مسح المعمارية: `Next.js`، `Supabase`، خدمات خارجية (OpenWeather/EOSDA/Sentinel/Mapbox/AI).
   - فحص نقاط الدخول والـAPI وملفات التهيئة: `app/api/*`, `next.config.mjs`, `vercel.json`, `package.json`.
   - تحليل إدارة الأسرار والبيئة: `.env.example` ومطابقة الاستخدام داخل الكود.
   - تقييم التسجيل والأخطاء والاختبارات وCI/CD.
2. تدقيق الإنتاج (قراءة فقط):
   - فحص headers لـ`https://adham-agritech.com` (`status`, `server`, `x-vercel-id`, `cache-control`).
   - محاولة جلب ملفات البناء العامة (مثل `/_next/build-manifest.json`, `/_next/data/*`) لتحديد نسخة Next.js والبناء.
   - التحقق من توفّر صفحات رئيسية ولوحة القيادة وRoutes الصحية و`/api/services/health` إن كانت مكشوفة.
   - مقارنة التصرّف مع ما هو متوقع من المستودع (وجود/غياب Routes، اختلافات هيكلية).
3. ربط الإنتاج بالمصدر (استقصاء):
   - تحديد إن كان مشروع Vercel مرتبطًا بمستودع Git مختلف (Imported project بدون ربط Git) عبر عنوان المشروع وheaders.
   - مراجعة إعدادات `vercel.json` و`next.config.mjs` في المستودع مقابل سلوك الإنتاج (إعادة كتابة/توجيه/رؤوس أمنية).
4. تحليل فجوة البيئة:
   - رسم قائمة المتغيرات الحرجة (Supabase/Mapbox/Weather/EOSDA/AI) ومقارنتها بالاستخدام؛ تحديد متغيرات مفقودة/خاطئة/غير متسقة التي قد تسبب تعطل الوظائف.
5. المخرجات:
   - تقرير فني تفصيلي: حالة المستودع، حالة الإنتاج ( headers وتحليل عام)، فجوات الربط، أسباب محتملة لتعطّل الإنتاج، وتحسينات آمنة بالأولوية.
   - خطة انتقال تدريجية: إنشاء Staging منفصل (اختياري لاحقًا) لاختبار الإصلاحات بدون المساس بالإنتاج.

## خطوات التنفيذ (بعد الموافقة)
1. جمع دلائل الإنتاج (قراءة فقط):
   - تنفيذ فحص headers وملفات البناء العامة لـ`adham-agritech.com`.
   - محاولة الوصول إلى `/api/services/health` إن كانت متاحة عامة.
2. مسح المستودع بشكل منهجي:
   - استخراج قائمة Routes وملفات التهيئة واستخدام المتغيرات.
   - رصد النقاط الحساسة (مصادقة/RLS/مكالمات خارجية/محدّدات وقت/التخزين المؤقت).
3. إعداد تقرير الفرق وإرجاع توصيات:
   - خرائط الفرق بين Routes المتوقعة والموجودة في الإنتاج.
   - توصيات آمنة: تحسين رؤوس الأمن، موحّد التسجيل، ضبط البيئة، إضافة caching/backoff.
4. (اختياري لاحقًا وبموافقة صريحة) إعداد بيئة Staging:
   - استنساخ المستودع إلى مشروع Vercel منفصل، تعيين مفاتيح محدودة، اختبار إصلاحات دون تعطيل الإنتاج.

## افتراضات
- `adham-agritech.com` يستضيف تطبيق Next.js على Vercel.
- الوصول إلى قراءة سجلات Vercel أو headers العامة ممكن؛ لا نحتاج أي صلاحيات كتابة.

## المخرجات المتوقعة
- تقرير فني شامل مع أولويات إصلاح قصيرة الأجل (بيئة/رؤوس/Routes/تسجيل) دون المساس بالإنتاج.
- خريطة واضحة لخطوة Staging إذا رغبت بذلك.